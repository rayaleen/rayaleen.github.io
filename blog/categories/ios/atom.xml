<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: iOS | Ray's Home]]></title>
  <link href="http://rayaleen.github.io/blog/categories/ios/atom.xml" rel="self"/>
  <link href="http://rayaleen.github.io/"/>
  <updated>2013-08-29T23:02:01+08:00</updated>
  <id>http://rayaleen.github.io/</id>
  <author>
    <name><![CDATA[Ray Chen]]></name>
    <email><![CDATA[rayaleen@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[nil/Nil/Null/NSNull]]></title>
    <link href="http://rayaleen.github.io/blog/2013/08/27/nil-slash-nil-slash-null-slash-nsnull/"/>
    <updated>2013-08-27T21:26:00+08:00</updated>
    <id>http://rayaleen.github.io/blog/2013/08/27/nil-slash-nil-slash-null-slash-nsnull</id>
    <content type="html"><![CDATA[<p>最近遇到了iOS里面各种关于<code>null</code>的表达，有时候用<code>nil</code>，有时候就用<code>NULL</code>，之前没有做过太深的研究，正好看到一篇关于这个区别的文章，拿来翻译一下，加深一下自己的理解。
原文地址:<a href="http://nshipster.com/nil/">http://nshipster.com/nil/</a>
在Objective-C里面，有很多种形式来表现空值。究其原因要追溯到Ojbective-C如何把面向过程的C和面向对象编程映射起来的，具体可以参考<a href="http://nshipster.com/ns_enum-ns_options/">a common NSHipster refrain</a>
在C里面，基本类型都是用0来表示空值的，而用NULL来表示指针为空(在指针的情况下是等同于0(<a href="http://c-faq.com/null/nullor0.html">http://c-faq.com/null/nullor0.html</a>)
Objective-C在C原有的空值的表达上增加了nil, nil是一个指向空值的对象指针。虽然语义上来说跟NULL是有区别的，但在技术实现上是等价的。
在framework层，foundation定义的<code>NSNull</code>有一个类方法，这个方法返回NSNull的单例。NSNull不同于ni或者NULL，因为它的确是一个对象，而不是0。</p>

<p>除此之外，在，Nil被定义为指向空值的类指针，这个不像nil出现很多次，但是也是表达空值。</p>

<h3>关于nil的一些东东</h3>

<p>新创建的NSObject开始于内部值都为0。也就是说，它所包含的指向其他对象的指针都是以nil开始的，所以没有必要在ini的方法里，把指针设为nil.</p>

<p>也许nil最引人注目的好处就是可以往它发送消息。
在其他语言里面，比如c++，这个会使你的程序崩溃，但是在objective-C里面，在nil上调用一个方法只会返回0值。这是一个简单的表达方式，因为你在任何事情之前都不用复查一下是否是nil。
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>// For example, this expression&hellip;
</span><span class='line'>if (name != nil &amp;&amp; [name isEqualToString:@&ldquo;Steve&rdquo;]) { &hellip; }&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>// &hellip;can be simplified to:
</span><span class='line'>if ([name isEqualToString:@&ldquo;steve&rdquo;]) { &hellip; }</span></code></pre></td></tr></table></div></figure></notextile></div>
应该意识到nil在Objective-C里面的这个特征给我们带了很多方便，而不是代码上潜在的bug。在那些确实不需要nil值的地方，通过增加一些核对的方法尽早返回或者通过使用<code>NSAssertParameter</code>来抛出异常。
NSNull : 为了表达空值的值
NSNull是为了在Fouundation和其他框架里绕过一个结合类的限制，比如<code>NSArray</code>和<code>NSDictionary</code>不可以包含nil值。你可以把NSNull想象成为NULL或者是nil的封装类，这样子他们就可以用于集合类里面
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSMutableDictionary &lt;em>mutableDictionary = [NSMutableDictionary dictionary];
</span><span class='line'>mutableDictionary[@&ldquo;someKey&rdquo;] = [NSNull null]; // Sets value of NSNull singleton for &lt;code>someKey&lt;/code>
</span><span class='line'>NSLog(@&ldquo;Keys: %@&rdquo;, [mutableDictionary allKeys]); // @[@&ldquo;someKey&rdquo;]</span></code></pre></td></tr></table></div></figure></notextile></div>
总结一下，每个Objective-C程序员都应该了解的四中代表空值的值:
Symbol | Value | Meaning
:&mdash;&mdash;&mdash;&mdash;&mdash;|:&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;:|&mdash;&mdash;&mdash;&mdash;&mdash;:
NULL | (void </em>)0 | literal null value for C pointers
nil | (id)0 | literal null value for Objective-C objects
Nil | (Class)0 | literal null value for Objective-C classes
NSNull | [NSNull null] | singleton object used to represent null</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Apple HLS Study]]></title>
    <link href="http://rayaleen.github.io/blog/2013/08/23/apple-hls-study/"/>
    <updated>2013-08-23T23:19:00+08:00</updated>
    <id>http://rayaleen.github.io/blog/2013/08/23/apple-hls-study</id>
    <content type="html"><![CDATA[<p>最近因为工作需要了解Apple HLS(HTTP Live Streaming)的技术，看了很多文档资料，就把自己的一些理解写下来算作一个总结。</p>

<h2>什么是HLS</h2>

<p>HLS是苹果公司提出一个可以在iOS, iPad或者QuickTime运行的一个HTTP流媒体解决方案。现在主流的网络视频软件，基本上都会提供VOD(video on demand)和live这两种播放方式，当然使用HLS也可以实现同样的功能。既然称作streaming,就应该有一些stream的特质，最主要的就是客户端不会一次获得视频源文件甚至下载地址，而且通过一系列的数据流不停的提供给客户端，从而实现完整的视频流的感觉。</p>

<h2>Stream如何实现</h2>

<p>HLS的stream是怎么样实现的呢？在这篇<a href="http://blog.nkbit.com/2011/11/http-live-streaming.html">blog</a>里面，作者用一个黄瓜切片的例子来解释HLS stream的原理。其实就是将一个视频文件通过一系列的工具，最后切成一片一片(slice)的视频文件(ts file)，然后把这些视频文件按照播放顺序放在m3u8的playlist里面，播放器看到这个m3u8的playlist就知道该去哪拿视频，按照什么顺序播放了。</p>

<h2>M3U8</h2>

<p>下面是一个VOD M3U8的例子
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTM3U&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-PLAYLIST-TYPE:VOD&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-TARGETDURATION:10  //最大duration是10s&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-VERSION:3&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-MEDIA-SEQUENCE:0&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTINF:10.0,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://example.com/movie1/fileSequenceA.ts">http://example.com/movie1/fileSequenceA.ts&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTINF:10.0,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://example.com/movie1/fileSequenceB.ts">http://example.com/movie1/fileSequenceB.ts&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTINF:10.0,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://example.com/movie1/fileSequenceC.ts">http://example.com/movie1/fileSequenceC.ts&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTINF:9.0,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://example.com/movie1/fileSequenceD.ts">http://example.com/movie1/fileSequenceD.ts&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-ENDLIST&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></notextile></div>
在上面的M3U8里面，很清晰的描述了playlist type是VOD(#EXT-X-PLAYLIST-TYPE)，playlist version是3(#EXT-X-VERSION)， 每个ts的duration是10s(#EXTINF:10.0)，我们可以知道每一个ts的地址(<a href="http://example.com/movie1/fileSequenceA.ts">http://example.com/movie1/fileSequenceA.ts</a>)，然后player就会用这个地址和顺序去播放视频。因为是VOD类型，所以最后加了#EXT-X-ENDLIST，如果没有这个tag，那就是live streaming，并且这个m3u8 playlist 将会是一个Sliding Window，里面ts的序列是不停增加和移除的，而且每变动一次，EXT-X-MEDIA-SEQUENCE这个tag也会相应的+1.关于更多tag的描述可以参考<a href="https://developer.apple.com/library/ios/technotes/tn2288/_index.html">Example Playlist Files for use with HTTP Live Streaming</a></p>

<h2>Adaptive Stream</h2>

<p>HLS还支持Adaptive Stream，就是说可以提供给用户不同bandwidth，resolution的stream,然后player会根据用户现在网络情况，用的是iPhone还是iPad来选择最合适的stream。
首先，server要首先提供一个basic variant playlist
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXTM3U&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=150000,RESOLUTION=416x234, \&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>CODECS=&ldquo;avc1.42e00a,mp4a.40.2&rdquo;
</span><span class='line'>&lt;a href="http://example.com/low/index.m3u8">http://example.com/low/index.m3u8&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=240000,RESOLUTION=416x234, \&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>CODECS=&ldquo;avc1.42e00a,mp4a.40.2&rdquo;
</span><span class='line'>&lt;a href="http://example.com/lo_mid/index.m3u8">http://example.com/lo_mid/index.m3u8&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=440000,RESOLUTION=416x234, \&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>CODECS=&ldquo;avc1.42e00a,mp4a.40.2&rdquo;
</span><span class='line'>&lt;a href="http://example.com/hi_mid/index.m3u8">http://example.com/hi_mid/index.m3u8&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=640000,RESOLUTION=640x360, \&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>CODECS=&ldquo;avc1.42e00a,mp4a.40.2&rdquo;
</span><span class='line'>&lt;a href="http://example.com/high/index.m3u8">http://example.com/high/index.m3u8&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=64000,CODECS=&ldquo;mp4a.40.5&rdquo;&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="http://example.com/audio/index.m3u8">http://example.com/audio/index.m3u8&lt;/a></span></code></pre></td></tr></table></div></figure></notextile></div>
可以看到，这个M3U8里面包含了五种不同bandwidth和resolution视频源，当player读取这个M3U8之后，就会根据现在用户的bandwidth和device来确定用哪一个片源的index.M3U8,然后再去读一个新的M3U8就可以播放了。如果中间player发现用户的bandwidth升高或者降低，也会相应的调整片源来实现adaptive stream.</p>

<p>如果用html5的video tag也只能在safari上正常播放HLS，如果是Chrome或者是Firefox，就会彻底的死火更别说Adaptive Stream.</p>
]]></content>
  </entry>
  
</feed>
